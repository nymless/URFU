pipeline {
    agent any
    environment {
        TRAIN_PATH      = 'train/train.csv'
        TRAIN_PREP_PATH = 'train/train_prep.csv'
        TEST_PATH       = 'test/test.csv'
        TEST_PREP_PATH  = 'test/test_prep.csv'
        MODEL_PATH      = 'model/model.pkl'
        PROJECT_PATH    = 'MLOps/Lab-2'
    }
    stages {
        stage('Setup Python Environment') {
            steps {
                echo 'Setting up Python virtual environment'
                sh '''
                python3 -m venv venv
                source venv/bin/activate
                pip install -r $PROJECT_PATH/requirements.txt
                '''
            }
        }
        stage('Create data') {
            steps {
                echo 'Data creation'
                sh '''
                source venv/bin/activate
                python3 $PROJECT_PATH/src/data_creation.py
                '''
            }
        }
        stage('Preprocess data') {
            steps {
                echo 'Data preprocessing'
                sh '''
                source venv/bin/activate
                python3 $PROJECT_PATH/src/data_preprocessing.py
                '''
            }
        }
        stage('Prepare model') {
            steps {
                echo 'Model preparation'
                sh '''
                source venv/bin/activate
                python3 $PROJECT_PATH/src/model_preparation.py
                '''
            }
        }
        stage('Test model') {
            steps {
                echo 'Model testing'
                sh '''
                source $VENV_PATH/bin/activate
                python3 $PROJECT_PATH/src/model_testing.py
                '''
            }
        }
    }
}
